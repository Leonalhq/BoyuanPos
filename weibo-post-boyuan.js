 // ==UserScript==
// @name              ä¼¯è¿œæ­£èƒ½é‡_æµ‹è¯•ç‰ˆ
// @namespace         https://github.com/inu1255/soulsign-chrome
// @version           1.0.4
// @author            Leona kun
// @loginURL          https://weibo.com
// @expire            900e3
// @domain            weibo.com
// @domain            cms.metazion.fun
// @param             times æ¬¡æ•°
// ==/UserScript==

/**
@param {string} times - æ¬¡æ•°
*/

// ã€æœ¬åœ°è¶…è¯åˆ—è¡¨ã€‘
// hid è¶…è¯ID
// hname è¶…è¯åç§°
// text å¸–å­å†…å®¹
// picture å¸–å­é™„å›¾

 
var emojis = ['ğŸ˜„','ğŸ˜€','ğŸ˜Š','ğŸ˜‰','ğŸ˜','ğŸ˜˜','ğŸ˜š','ğŸ˜—','ğŸ˜™','ğŸ˜œ','ğŸ˜','ğŸ˜›','ğŸ˜³','ğŸ˜','ğŸ˜”','ğŸ˜Œ','ğŸ˜’','ğŸ˜','ğŸ˜£','ğŸ˜¢','ğŸ˜‚','ğŸ˜­','ğŸ˜ª','ğŸ˜¥','ğŸ˜°','ğŸ˜…','ğŸ˜“','ğŸ˜©','ğŸ˜«','ğŸ˜¨','ğŸ˜±','ğŸ˜ ','ğŸ˜¡','ğŸ˜¤','ğŸ˜–','ğŸ˜†','ğŸ˜‹','ğŸ˜·','ğŸ˜','ğŸ˜´','ğŸ˜µ','ğŸ˜²','ğŸ˜Ÿ','ğŸ˜¦','ğŸ˜§','ğŸ˜ˆ','ğŸ‘¿','ğŸ˜®','ğŸ˜¬','ğŸ˜','ğŸ˜•','ğŸ˜¯','ğŸ˜¶','ğŸ˜‡','ğŸ˜','ğŸ˜‘','ğŸ‘²','ğŸ‘³','ğŸ‘®','ğŸ‘·','ğŸ’‚','ğŸ‘¶','ğŸ‘¦','ğŸ‘§','ğŸ‘¨','ğŸ‘©','ğŸ‘´','ğŸ‘µ','ğŸ‘±','ğŸ‘¼','ğŸ‘¸','ğŸ˜º','ğŸ˜¸','ğŸ˜»','ğŸ˜½','ğŸ˜¼','ğŸ™€','ğŸ˜¿','ğŸ˜¹','ğŸ˜¾','ğŸ‘¹','ğŸ‘º','ğŸ™ˆ','ğŸ™‰','ğŸ™Š','ğŸ’€','ğŸ‘½','ğŸ’©','ğŸ”¥','âœ¨','ğŸŒŸ','ğŸ’«','ğŸ’¥','ğŸ’¢','ğŸ’¦','ğŸ’§','ğŸ’¤','ğŸ’¨','ğŸ‘‚','ğŸ‘€','ğŸ‘ƒ','ğŸ‘…','ğŸ‘„','ğŸ‘','ğŸ‘','ğŸ‘Œ','ğŸ‘Š','âœŠ','âœŒ','ğŸ‘‹','âœ‹','ğŸ‘','ğŸ‘†','ğŸ‘‡','ğŸ‘‰','ğŸ‘ˆ','ğŸ™Œ','ğŸ™','â˜','ğŸ‘','ğŸ’ª','ğŸš¶','ğŸƒ','ğŸ’ƒ','ğŸ‘«','ğŸ‘ª','ğŸ‘¬','ğŸ‘­','ğŸ’','ğŸ’‘','ğŸ‘¯','ğŸ™†','ğŸ™…','ğŸ’','ğŸ™‹','ğŸ’†','ğŸ’‡','ğŸ’…','ğŸ‘°','ğŸ™','ğŸ™','ğŸ™‡','ğŸ©','ğŸ‘‘','ğŸ‘’','ğŸ‘Ÿ','ğŸ‘','ğŸ‘¡','ğŸ‘ ','ğŸ‘¢','ğŸ‘•','ğŸ‘”','ğŸ‘š','ğŸ‘—','ğŸ½','ğŸ‘–','ğŸ‘˜','ğŸ‘™','ğŸ’¼','ğŸ‘œ','ğŸ‘','ğŸ‘›','ğŸ‘“','ğŸ€','ğŸŒ‚','ğŸ’„','ğŸ’›','ğŸ’™','ğŸ’œ','ğŸ’š','â¤','ğŸ’”','ğŸ’—','ğŸ’“','ğŸ’•','ğŸ’–','ğŸ’','ğŸ’˜','ğŸ’Œ','ğŸ’‹','ğŸ’','ğŸ’','ğŸ‘¤','ğŸ‘¥','ğŸ’¬','ğŸ‘£','ğŸ’­','ğŸ¶','ğŸº','ğŸ±','ğŸ­','ğŸ¹','ğŸ°','ğŸ¸','ğŸ¯','ğŸ¨','ğŸ»','ğŸ·','ğŸ½','ğŸ®','ğŸ—','ğŸµ','ğŸ’','ğŸ´','ğŸ‘','ğŸ˜','ğŸ¼','ğŸ§','ğŸ¦','ğŸ¤','ğŸ¥','ğŸ£','ğŸ”','ğŸ','ğŸ¢','ğŸ›','ğŸ','ğŸœ','ğŸ','ğŸŒ','ğŸ™','ğŸš','ğŸ ','ğŸŸ','ğŸ¬','ğŸ³','ğŸ‹','ğŸ„','ğŸ','ğŸ€','ğŸƒ','ğŸ…','ğŸ‡','ğŸ‰','ğŸ','ğŸ','ğŸ“','ğŸ•','ğŸ–','ğŸ','ğŸ‚','ğŸ²','ğŸ¡','ğŸŠ','ğŸ«','ğŸª','ğŸ†','ğŸˆ','ğŸ©','ğŸ¾','ğŸ’','ğŸŒ¸','ğŸŒ·','ğŸ€','ğŸŒ¹','ğŸŒ»','ğŸŒº','ğŸ','ğŸƒ','ğŸ‚','ğŸŒ¿','ğŸŒ¾','ğŸ„','ğŸŒµ','ğŸŒ´','ğŸŒ²','ğŸŒ³','ğŸŒ°','ğŸŒ±','ğŸŒ¼','ğŸŒ','ğŸŒ','ğŸŒ','ğŸŒš','ğŸŒ‘','ğŸŒ’','ğŸŒ“','ğŸŒ”','ğŸŒ•','ğŸŒ–','ğŸŒ—','ğŸŒ˜','ğŸŒœ','ğŸŒ›','ğŸŒ™','ğŸŒ','ğŸŒ','ğŸŒ','ğŸŒ‹','ğŸŒŒ','ğŸŒ ','â­','â˜€','â›…','â˜','âš¡','â˜”','â„','â›„','ğŸŒ€','ğŸŒ','ğŸŒˆ','ğŸŒŠ','ğŸ','ğŸ’','ğŸ','ğŸ’','ğŸ“','ğŸ','ğŸ†','ğŸ‡','ğŸ','ğŸ‘','ğŸƒ','ğŸ‘»','ğŸ…','ğŸ„','ğŸ','ğŸ‹','ğŸ‰','ğŸŠ','ğŸˆ','ğŸŒ','ğŸ”®','ğŸ¥','ğŸ“·','ğŸ“¹','ğŸ“¼','ğŸ’¿','ğŸ“€','ğŸ’½','ğŸ’¾','ğŸ’»','ğŸ“±','â˜','ğŸ“','ğŸ“Ÿ','ğŸ“ ','ğŸ“¡','ğŸ“º','ğŸ“»','ğŸ”Š','ğŸ”‰','ğŸ”ˆ','ğŸ”‡','ğŸ””','ğŸ”•','ğŸ“¢','ğŸ“£','â³','âŒ›','â°','âŒš','ğŸ”“','ğŸ”’','ğŸ”','ğŸ”','ğŸ”‘','ğŸ”','ğŸ’¡','ğŸ”¦','ğŸ”†','ğŸ”…','ğŸ”Œ','ğŸ”‹','ğŸ”','ğŸ›','ğŸ›€','ğŸš¿','ğŸš½','ğŸ”§','ğŸ”©','ğŸ”¨','ğŸšª','ğŸš¬','ğŸ’£','ğŸ”«','ğŸ”ª','ğŸ’Š','ğŸ’‰','ğŸ’°','ğŸ’´','ğŸ’µ','ğŸ’·','ğŸ’¶','ğŸ’³','ğŸ’¸','ğŸ“²','ğŸ“§','ğŸ“¥','ğŸ“¤','âœ‰','ğŸ“©','ğŸ“¨','ğŸ“¯','ğŸ“«','ğŸ“ª','ğŸ“¬','ğŸ“­','ğŸ“®','ğŸ“¦','ğŸ“','ğŸ“„','ğŸ“ƒ','ğŸ“‘','ğŸ“Š','ğŸ“ˆ','ğŸ“‰','ğŸ“œ','ğŸ“‹','ğŸ“…','ğŸ“†','ğŸ“‡','ğŸ“','ğŸ“‚','âœ‚','ğŸ“Œ','ğŸ“','âœ’','âœ','ğŸ“','ğŸ“','ğŸ“•','ğŸ“—','ğŸ“˜','ğŸ“™','ğŸ““','ğŸ“”','ğŸ“’','ğŸ“š','ğŸ“–','ğŸ”–','ğŸ“›','ğŸ”¬','ğŸ”­','ğŸ“°','ğŸ¨','ğŸ¬','ğŸ¤','ğŸ§','ğŸ¼','ğŸµ','ğŸ¶','ğŸ¹','ğŸ»','ğŸº','ğŸ·','ğŸ¸','ğŸ‘¾','ğŸ®','ğŸƒ','ğŸ´','ğŸ€„','ğŸ²','ğŸ¯','ğŸˆ','ğŸ€','âš½','âš¾','ğŸ¾','ğŸ±','ğŸ‰','ğŸ³','â›³','ğŸšµ','ğŸš´','ğŸ','ğŸ‡','ğŸ†','ğŸ¿','ğŸ‚','ğŸŠ','ğŸ„','ğŸ£','â˜•','ğŸµ','ğŸ¶','ğŸ¼','ğŸº','ğŸ»','ğŸ¸','ğŸ¹','ğŸ·','ğŸ´','ğŸ•','ğŸ”','ğŸŸ','ğŸ—','ğŸ–','ğŸ','ğŸ›','ğŸ¤','ğŸ±','ğŸ£','ğŸ¥','ğŸ™','ğŸ˜','ğŸš','ğŸœ','ğŸ²','ğŸ¢','ğŸ¡','ğŸ³','ğŸ','ğŸ©','ğŸ®','ğŸ¦','ğŸ¨','ğŸ§','ğŸ‚','ğŸ°','ğŸª','ğŸ«','ğŸ¬','ğŸ­','ğŸ¯','ğŸ','ğŸ','ğŸŠ','ğŸ‹','ğŸ’','ğŸ‡','ğŸ‰','ğŸ“','ğŸ‘','ğŸˆ','ğŸŒ','ğŸ','ğŸ','ğŸ ','ğŸ†','ğŸ…','ğŸŒ½','ğŸ ','ğŸ¡','ğŸ«','ğŸ¢','ğŸ£','ğŸ¥','ğŸ¦','ğŸª','ğŸ©','ğŸ¨','ğŸ’’','â›ª','ğŸ¬','ğŸ¤','ğŸŒ‡','ğŸŒ†','ğŸ¯','ğŸ°','â›º','ğŸ­','ğŸ—¼','ğŸ—¾','ğŸ—»','ğŸŒ„','ğŸŒ…','ğŸŒƒ','ğŸ—½','ğŸŒ‰','ğŸ ','ğŸ¡','â›²','ğŸ¢','ğŸš¢','â›µ','ğŸš¤','ğŸš£','âš“','ğŸš€','âœˆ','ğŸ’º','ğŸš','ğŸš‚','ğŸšŠ','ğŸš‰','ğŸš','ğŸš†','ğŸš„','ğŸš…','ğŸšˆ','ğŸš‡','ğŸš','ğŸš‹','ğŸšƒ','ğŸš','ğŸšŒ','ğŸš','ğŸš™','ğŸš˜','ğŸš—','ğŸš•','ğŸš–','ğŸš›','ğŸšš','ğŸš¨','ğŸš“','ğŸš”','ğŸš’','ğŸš‘','ğŸš','ğŸš²','ğŸš¡','ğŸšŸ','ğŸš ','ğŸšœ','ğŸ’ˆ','ğŸš','ğŸ«','ğŸš¦','ğŸš¥','âš ','ğŸš§','ğŸ”°','â›½','ğŸ®','ğŸ°','â™¨','ğŸ—¿','ğŸª','ğŸ­','ğŸ“','ğŸš©','â¬†','â¬‡','â¬…','â¡','ğŸ” ','ğŸ”¡','ğŸ”¤','â†—','â†–','â†˜','â†™','â†”','â†•','ğŸ”„','â—€','â–¶','ğŸ”¼','ğŸ”½','â†©','â†ª','â„¹','âª','â©','â«','â¬','â¤µ','â¤´','ğŸ†—','ğŸ”€','ğŸ”','ğŸ”‚','ğŸ†•','ğŸ†™','ğŸ†’','ğŸ†“','ğŸ†–','ğŸ“¶','ğŸ¦','ğŸˆ','ğŸˆ¯','ğŸˆ³','ğŸˆµ','ğŸˆ´','ğŸˆ²','ğŸ‰','ğŸˆ¹','ğŸˆº','ğŸˆ¶','ğŸˆš','ğŸš»','ğŸš¹','ğŸšº','ğŸš¼','ğŸš¾','ğŸš°','ğŸš®','ğŸ…¿','â™¿','ğŸš­','ğŸˆ·','ğŸˆ¸','ğŸˆ‚','â“‚','ğŸ›‚','ğŸ›„','ğŸ›…','ğŸ›ƒ','ğŸ‰‘','ãŠ™','ãŠ—','ğŸ†‘','ğŸ†˜','ğŸ†”','ğŸš«','ğŸ”','ğŸ“µ','ğŸš¯','ğŸš±','ğŸš³','ğŸš·','ğŸš¸','â›”','âœ³','â‡','â','âœ…','âœ´','ğŸ’Ÿ','ğŸ†š','ğŸ“³','ğŸ“´','ğŸ…°','ğŸ…±','ğŸ†','ğŸ…¾','ğŸ’ ','â¿','â™»','â™ˆ','â™‰','â™Š','â™‹','â™Œ','â™','â™','â™','â™','â™‘','â™’','â™“','â›','ğŸ”¯','ğŸ§','ğŸ’¹','ğŸ’²','ğŸ’±','Â©','Â®','â„¢','ã€½','ã€°','ğŸ”','ğŸ”š','ğŸ”™','ğŸ”›','ğŸ”œ','âŒ','â­•','â—','â“','â•','â”','ğŸ”ƒ','ğŸ•›','ğŸ•§','ğŸ•','ğŸ•œ','ğŸ•‘','ğŸ•','ğŸ•’','ğŸ•','ğŸ•“','ğŸ•Ÿ','ğŸ•”','ğŸ• ','ğŸ••','ğŸ•–','ğŸ•—','ğŸ•˜','ğŸ•™','ğŸ•š','ğŸ•¡','ğŸ•¢','ğŸ•£','ğŸ•¤','ğŸ•¥','ğŸ•¦','âœ–','â•','â–','â—','â™ ','â™¥','â™£','â™¦','ğŸ’®','ğŸ’¯','âœ”','â˜‘','ğŸ”˜','ğŸ”—','â°','ğŸ”±','ğŸ”²','ğŸ”³','â—¼','â—»','â—¾','â—½','â–ª','â–«','ğŸ”º','â¬œ','â¬›','âš«','âšª','ğŸ”´','ğŸ”µ','ğŸ”»','ğŸ”¶','ğŸ”·','ğŸ”¸','ğŸ”¹']
var pics =  ['002jiQKGly1gnzvvtfi7gj60j60nz0td02','002jiQKGly1gnzvvtfsbfj60j60nz0tj02','002jiQKGly1gnzvvth29aj60j60nz75a02','0072KUQXly1ghh1d0daf7j30jg163t9r',"006wv27Uly1gr0n60itkhj31o01o0hdt","5ed752a6gy1gr3ns9zy4lj20j60j6dif"]

let chaohuas = [
    {
        "hid": "100808c58cd9e27740c6aae77baa96d6538cab",
        "hname": "ä¼¯è¿œfly",
        "text": "",
        "picture": ""
      },
  ];
  
  // å½“å‰æ—¶é—´æˆ³
  const timestamp = new Date().getTime();
  
  // ç”¨æˆ·ID
  let sid = '0';
  
  function sleep(milliseconds) {
    return new Promise((resolve) => setTimeout(resolve, milliseconds));
  }
  
  function objectToUrlEncodedParams(obj) {
    return Object.entries(obj)
      .map(([key, value]) => `${encodeURIComponent(key)}=${encodeURIComponent(value)}`)
      .join('&');
  }
  
  async function fetchData() {
    const url = `https://cms.metazion.fun/weibo-chaohua-posts`;
    const rsp = await axios.get(url);
  
    if (rsp.status != 200) {
      return {
        success: false,
        msg: `æ‹‰å–æ•°æ®: ${rsp.status}-æ“ä½œå¤±è´¥`
      };
    }
  
    chaohuas = rsp.data;
  
    return {
      success: true,
      msg: `æ‹‰å–æ•°æ®: æ“ä½œæˆåŠŸ`,
    };
  }
  
  async function goHome() {
    const url = `https://weibo.com`;
    const rsp = await axios.get(url);
  
    if (rsp.status != 200) {
      return {
        success: false,
        msg: `è¿›å…¥ä¸»é¡µ: ${rsp.status}-æ“ä½œå¤±è´¥`
      };
    }
  
    const jstring = JSON.stringify(rsp.data);
  
    const result = /CONFIG\['uid'\]='(\d*?)'/.exec(jstring);
    if (result == null || result.length < 2) {
      return {
        success: false,
        msg: `ç”¨æˆ·ID: è·å–å¤±è´¥`
      };
    }
  
    sid = result[1];
    return {
      success: true,
      msg: `ç”¨æˆ·ID: ${sid}`
    };
  }
    //æ­£èƒ½é‡
  async function getPos() {

    // let response = await fetch("https://data.zhai78.com/openOneGood.php")
    //æ–°çš„è¯­å½•api
    let response = await fetch("https://api.66mz8.com/api/quotation.php?format=json")
    let data = await response.json()
    return data
  }
  
   function getEmo(){
    return  emojis[Math.floor(Math.random() * emojis.length)];
   }

     
   function getPictures(){
    return  pics[Math.floor(Math.random() * pics.length)];
   }

   function getRandom (n, m) {
    var num = Math.floor(Math.random() * (m - n + 1) + n)
    return num
}
  
  
  
  async function doPost(hid, hname, text, picture) {
    const url = `https://weibo.com/p/aj/proxy?ajwvr=6&__rnd=${timestamp}`;
  
    const rsp = await axios({
      url: url,
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
        'X-Requested-With': 'XMLHttpRequest',
        'Origin': 'https://weibo.com',
        'Referer': `https://weibo.com/p/${hid}/super_index`
      },
      data: {
        'id': hid,
        'domain': '100808',
        'module': 'share_topic',
        'title': '%E5%8F%91%E5%B8%96',
        'content': '',
        'api_url': 'http://i.huati.weibo.com/pcpage/super/publisher',
        'spr': '',
        'extraurl': '',
        'is_stock': '',
        'check_url': `http%3A%2F%2Fi.huati.weibo.com%2Faj%2Fsuperpublishauth%26pageid%3D${hid}%26uid%3D1764819037`,
        'location': 'page_100808_super_index',
        'text': text,
        'appkey': '',
        'style_type': 1,
        'pic_id': picture,
        'tid': '',
        'pdetail': hid,
        'mid': '',
        'isReEdit': 'false',
        'sync_wb': 1,
        'pub_source': 'page_2',
        'api': `http://i.huati.weibo.com/pcpage/operation/publisher/sendcontent?sign=super&page_id=${hid}`,
        'longtext': 1,
        'topic_id': `1022:${hid}`,
        'pub_type': 'dialog',
        '_t': 0
      },
      transformRequest: [function (data) {
        return objectToUrlEncodedParams(data);
      }]
    });
  
    if (rsp.status != 200) {
      return {
        success: false,
        msg: `è¶…è¯å‘å¸–[${hname}]: ${rsp.status}-æ“ä½œå¤±è´¥`
      };
    }
  
    return {
      success: rsp.data.code == '100000',
      msg: `è¶…è¯å‘å¸–[${hname}]: ${rsp.data.code}-${rsp.data.msg}`
    };
  }
  
  exports.run = async function(param) {
    let result = {};
  
    // ä»äº‘ç«¯æ‹‰å–è¶…è¯åˆ—è¡¨ï¼Œå¦‚ä½¿ç”¨æœ¬åœ°æ•°æ®ï¼Œè¯·åœ¨ä¸Šé¢é…ç½®ã€æœ¬åœ°è¶…è¯åˆ—è¡¨ã€‘å¹¶æ³¨é‡Šæ‰ä¸‹é¢4è¡Œ
    // result = await fetchData();
    // if (!result.success) {
    //   throw result.msg;
    // }
  
    // è¿›å…¥ç”¨æˆ·ä¸»é¡µ
    result = await goHome();
    if (!result.success) {
      throw result.msg;
    }
  
    // æ‰§è¡Œè¶…è¯æ‰¹é‡å‘å¸–
    let count = 0;
    for (let i = 0; i < param.times; i++){
        for (const chaohua of chaohuas) {

        //æ­£èƒ½é‡è¯­å½•
        pos = await getPos();
        if (pos['code'] !== 200) {
            throw pos.msg;
        }
        

        const hid = chaohua['hid'];
        const hname = chaohua['hname'];
        const header = "#çˆ±è±†våŠ›é‡#" +getEmo()+ " #çˆ±è±†èƒ½é‡æœˆ#\n\n";
        //   let x = header + pos['txt'] + "\n" + getEmo() + "\n"+ "\nä¼¯è¿œ@INTO1-ä¼¯è¿œ\n"+Math.random()*100;
        //ä¸ºäº†å‡‘å­—æ•°å€’è¿‡æ¥
        let x = header + pos['quotation']+pos['quotation'].split("").reverse().join("") + "\n" + getEmo()+getEmo()+ "\nä¼¯è¿œ@INTO1-ä¼¯è¿œ\n"+Math.random()*100;
        const text = x.replace(/\\r\\n/g, '\r\n')
        const picture = getPictures()
    
        let result = await doPost(hid, hname, text, picture);
        if (!result.success) {
            throw result.msg;
        }
    
        ++count;
        }
        let waittimer = getRandom(2111, 5211);
        await sleep(waittimer);
    }
  
    return `æ“ä½œæˆåŠŸ: å®Œæˆæ•°é‡[${count}]`;
  };
  
  exports.check = async function(param) {
    return true;
  };
  